function ResidualViolinandGB(outstruct,idx,genevct_,voxvgene_,listb,mrx3inds,bfpath,savenclose,figpath_)

if nargin < 8
    figpath_ = [cd filesep 'MatFiles'];
    if nargin < 7
        savenclose = 0;
    end
end

E_red = voxvgene_(:,mrx3inds);
C_red = genevct_(mrx3inds,:);
D = outstruct(idx).corrB;
E_infer = C_red*D.';
residuals = sum((E_infer - E_red.').^2);

hippinds = 26:36; neoinds = 57:94;
sampleinds = [hippinds,neoinds];
listBvec = nonzeros(listb);
samplebool = ismember(listBvec,sampleinds);
sample_errs = residuals(samplebool);
nonsample_errs = residuals(~samplebool);

datacell = {sample_errs,nonsample_errs};
rng('default');
xpos = zeros(length(residuals),1);
g = xpos;
xposscatter = @(x,y) 0.025 * (2*rand(length(x),1) - 1) + y;
plotindcell = {find(samplebool), find(~samplebool)};
for j = 1:length(plotindcell)
    curinds = plotindcell{j};
    g(curinds) = j;
    xpos(curinds) = xposscatter(curinds,j);
end

% Violin plot
cmap = [[0 0.5 1];[1 0 0.5]];
figure('Units','inches','Position',[0 0 5 6]); hold on;
% v = gscatter(xpos,residuals,g,cmap,[],10,'off');
% b = boxplot(residuals,g,'Colors',cmap,'Symbol','');
violin(datacell,'facecolor',cmap,'medc',[],'mc','r','plotlegend',0);
% set(b,{'linew'},{3})
set(gca, 'XTick', 1:2, 'XTickLabel', {'Cort/Hipp','Other'});
ylim([0,max(residuals)]); xlim([0.5,2.5]); yticks([]);
% ylabel('Residual');
xlabel('');
set(gca,'TickLength',[0 0])
set(gca,'FontSize',24,'FontName','Times','box','on');
if savenclose
    print([figpath_ filesep 'residual_boxpot'],'-dtiffn','-r600');
    close;
end

% Glass brain
addpath(bfpath);
residuals_reg = NaN(1,length(unique(listBvec)));
for j = 1:length(residuals_reg)
    curres = residuals(listBvec==j);
    residuals_reg(j) = mean(curres);
end
residuals_reg = ([residuals_reg(1:11) 0 residuals_reg(12:212)...
                    residuals_reg(1:11) 0 residuals_reg(12:212)]).';
reggroups = 2*ones(426,1); reggroups([sampleinds+1,sampleinds+214]) = 1;
imglabel = 'residual_gb_yaomiss';
imglabel = strrep(imglabel,'.','_');
input_struct = brainframe_inputs_mouse(bfpath,'region_groups',reggroups,...
                                             'cmap',cmap,...
                                             'xfac',2.5,...
                                             'sphere',1,...
                                             'sphere_npts',15,...
                                             'pointsize',0.1,...
                                             'voxUreg',1,...
                                             'data',residuals_reg,...
                                             'norm_method','max',...
                                             'bgcolor','w',...
                                             'img_labels',imglabel,...
                                             'img_format','tiffn',...
                                             'img_directory',figpath_,...
                                             'img_renderer','painters',...
                                             'savenclose',savenclose);
brainframe(input_struct);

end

