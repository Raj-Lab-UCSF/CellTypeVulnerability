function GeneVuln_vs_DE_Plot(corrmat_t_ct_,corrmat_t_gene_,genemat_, ...
    genenames_,ngenes_,thresh_,stdweight_)

path_metric_ct = mean(corrmat_t_ct_) ./ std(corrmat_t_ct_).^(stdweight_);
ctmean = mean(genemat_,1);
ctmean = repmat(ctmean,size(genemat_,1),1);
ctnorm = genemat_ ./ ctmean;
C_cellnorm = ctnorm;
lowexprinds = (sum(C_cellnorm,2) <= (thresh_*mean(sum(C_cellnorm,2))));
C_cellnorm(lowexprinds,:) = [];
genenames_(lowexprinds) = [];
corrmat_t_gene_(:,lowexprinds) = [];

C_mean = mean(C_cellnorm,2);
C_std = std(C_cellnorm,[],2);
zscore_mat = (C_cellnorm - repmat(C_mean,1,size(C_cellnorm,2)))./...
    repmat(C_std,1,size(C_cellnorm,2));
vuln_score = zscore_mat * path_metric_ct.';

path_metric_gene = mean(corrmat_t_gene_) ./ std(corrmat_t_gene_).^(stdweight_);
[~,sortinds_g] = sort(path_metric_gene,'descend');
vulngene_inds = sortinds_g(1:ngenes_);
notvuln_inds = setdiff(1:length(genenames_),vulngene_inds);
vs_vuln = vuln_score(vulngene_inds); vs_non = vuln_score(notvuln_inds);
g = ones(1,length(genenames_)); g(vulngene_inds) = 0;
xpos = 0.1 * (2*rand(1,length(g)) - 1) + g + 1;
inds = randperm(length(vs_non)); inds = inds(1:200);
[~,p] = ttest2(vs_non,vs_vuln);

figure; hold on;
boxplot(vuln_score,g,'Color',[[1 0 0];[0 0 1]]); 
s1 = scatter(xpos(vulngene_inds),vs_vuln,'ro','filled');
s2 = scatter(xpos(notvuln_inds(inds)),vs_non(inds),'bo','filled');
s3 = scatter(0,0,'wo');
xticklabels({'Vuln','Others'}); ylabel('Cell Type Vulnerability Score')
legend([s1,s2,s3],{sprintf('Mean Vuln = %.2f',mean(vs_vuln)),...
    sprintf('Mean Other = %.2f',mean(vs_non)),...
    sprintf('p = %.1d',p)},'Location','southwest')
xlim([0.5,2.5])
title(sprintf('Top %d Genes',ngenes_))
set(gca,'FontSize',16,'FontName','Times');
% histogram(vs_non,20,'Normalization','probability'); 
% histogram(vs_vuln,10,'Normalization','probability');
% legend({'Others','Vuln'});

mdl = fitlm(vuln_score,mean(corrmat_t_gene_).');
ys = predict(mdl,linspace(min(vuln_score),max(vuln_score)).');
figure; hold on;
scatter(vuln_score(notvuln_inds),mean(corrmat_t_gene_(:,notvuln_inds)).','bo','filled');
scatter(vuln_score(vulngene_inds),mean(corrmat_t_gene_(:,vulngene_inds)).','ro','filled');
ls = plot(linspace(min(vuln_score),max(vuln_score)),ys,'k--','LineWidth',2);
legend(ls,sprintf('R^2 = %.2f, p = %.1d',mdl.Rsquared.Adjusted,mdl.ModelFitVsNullModel.Pvalue),...
    'Location','northwest');
xlabel('Cell Type Vulnerability Score'); ylabel('Mean R, Pathology');
set(gca,'FontSize',16,'FontName','Times')

end