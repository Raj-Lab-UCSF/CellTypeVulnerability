function ClusteringSchematic(C, subclasses_, cmap_, usescatter, usetsne, savenclose, figdir)

if nargin < 7
    figdir = [cd filesep 'MatFiles'];
    if nargin < 6
        savenclose = 0;
    end
end

rng(0);
ntypes = length(subclasses_);
if ntypes == 42
    nonneuronal_inds = find(ismember(subclasses_,{'Endo','Astro','Oligo',...
        'Micro-PVM','SMC-Peri','VLMC'}));
    gaba_inds = find(ismember(subclasses_,{'Lamp5','Sncg','Meis2','CR',...
        'Pvalb','Sst','Sst Chodl','Vip'}));
    glutctx_other_inds = find(ismember(subclasses_,{'Car3','L4 RSP-ACA'}));
    ctxtest = @(x) strcmp(x(end),'X');
    glutctx_inds = find(logical(cell2mat(cellfun(ctxtest,subclasses_,'UniformOutput',false))));
    glutctx_inds = sort([glutctx_other_inds; glutctx_inds]);
    gluthipp_inds = setdiff((1:length(subclasses_)).',[nonneuronal_inds;gaba_inds;glutctx_inds]);
    indcell = {glutctx_inds,gluthipp_inds,gaba_inds,nonneuronal_inds};
    indtest = [glutctx_inds;gluthipp_inds;gaba_inds;nonneuronal_inds];
    if strcmp(cmap_,'cool')
        cmap_labs = cool(length(indcell));
    elseif strcmp(cmap_,'hsv')
        cmap_labs = hsv(length(indcell));
    elseif strcmp(cmap_,'lines')
        cmap_labs = lines(length(indcell));
    else
        cmap_labs = twocolor(cmap_(1,:),cmap_(2,:),length(indcell));
    end
else
    if strcmp(cmap_,'cool')
        cmap_labs = cool(length(subclasses_));
    elseif strcmp(cmap_,'hsv')
        cmap_labs = hsv(length(subclasses_));
    elseif strcmp(cmap_,'lines')
        cmap_labs = lines(length(subclasses_));
    else
        cmap_labs = twocolor(cmap_(1,:),cmap_(2,:),length(subclasses_));
    end
    indtest = 1:length(subclasses_);
    indcell = cell(1,length(subclasses_));
    for i = 1:length(indcell)   
        indcell{i} = i;
    end
end

cmap_ = zeros(length(indtest),3);
for i = 1:length(indtest)
    colorinds = zeros(1,length(indcell));
    for j = 1:length(indcell)
        colorinds(j) = ismember(i,indcell{j});
    end
    cmap_(i,:) = cmap_labs(logical(colorinds),:);
end
cmap_labs = cmap_(indtest,:);
C = C(:,indtest);
classlabs = {'Cort. Glut.', 'Hipp. Glut.', 'GABA', 'Non-Neur.'};
cmap_subclass = cmap_labs;
cmap_subclass_cell = cell(ntypes,1);
for i = 1:ntypes
    cmapi_str = num2str(cmap_subclass(i,:));
    cmapi_str = strrep(cmapi_str,' ','');
    cmap_subclass_cell{i} = cmapi_str;
end
cmap_class = unique(cmap_subclass,'rows');
cmap_class_cell = cell(length(classlabs),1);
for i = 1:length(classlabs)
    cmapi_str = num2str(cmap_class(i,:));
    cmapi_str = strrep(cmapi_str,' ','');
    cmap_class_cell{i} = cmapi_str;
end

C = C(:,1:36); % Only neurons
C_ = C ./ mean(C);
if usescatter
    nscatter = 100;
    dispersion = 10;
    labs_all = NaN(ntypes*nscatter,1);
    if usetsne
        opts = statset('MaxIter',1000,'TolFun',1e-10);
        Y = tsne(C_.','Standardize',true,'Verbose',0,'LearnRate',1000,...
            'Perplexity',50,'Options',opts,'Distance','euclidean');
    else
        [~,Y_] = pca(C_.');
        Y = NaN(length(labs_all),size(Y_,2));
        for i = 1:size(C_,2)
            Yi = repmat(Y_(i,:),nscatter,1) + (dispersion*rand(nscatter,size(Y_,2)));
            indsi = (1:nscatter) + i*size(C_,2);
            Y(indsi,:) = Yi;
            labs_all(indsi) = find(ismember(cmap_class_cell,cmap_subclass_cell(i)));
        end
    end
else
    if usetsne
        fprintf("Requires 'usescatter' property set to 1; using PCA\n")
    end
    [~,Y] = pca(C_.');
    labs_all = NaN(size(C,2),1);
    for i = 1:length(labs_all)
        labs_all(i) = find(ismember(cmap_class_cell,cmap_subclass_cell(i))); 
    end
end

Y_plot = Y;
Y_plot_max = repmat(max(Y_plot),size(Y,1),1);
Y_plot_min = repmat(min(Y_plot),size(Y,1),1);
Y_plot_norm = (Y_plot - Y_plot_min) ./ (Y_plot_max - Y_plot_min);
Y_plot = Y_plot_norm;
% if usescatter
%     Y_plot = Y_plot(1:(36*nscatter),:); % No non-neuronals for clarity
%     labs_all = labs_all(1:(36*nscatter));
%     cmap_class = cmap_class(1:3,:);
% else
%     Y_plot = Y_plot(1:36,:);
% end
figure('Position',[0 0 600 600]); hold on;
% for i = 1:size(Y_plot,1)
%     scatter3(Y_plot(i,1),Y_plot(i,2),Y_plot(i,3),50,cmap_labs(i,:),'filled');
% end
% view([1 1 1]);
gscatter(Y_plot(:,1),Y_plot(:,2),labs_all,cmap_class,[],30,0)
xticks([]); yticks([]); zticks([]);
set(gca,'XTickLabel',[],'YTickLabel',[],'ZTickLabel',[],'box','on');
if savenclose
    print([figdir filesep 'ClusteringSchematic_tSNE'],'-dtiffn','-r600');
    close
end
end