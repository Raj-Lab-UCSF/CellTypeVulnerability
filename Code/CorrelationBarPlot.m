function CorrelationBarPlot(corrmat_,datsetnames_,subclasses_,type,cmap_,savenclose,figdir_)
if nargin < 7
    figdir_ = cd;
    if nargin < 6
        savenclose = 0;
        if nargin < 5
            cmap_ = hsv(length(subclasses_));
            if nargin < 4
                type = 'Pearson';
            end
        end
    end
end

shapes = {'o','s','d','^','v','<','>','p','h','+','.','x'};
g = 1:size(corrmat_,2);
xpos = zeros(length(datsetnames_),length(g));
xposscatter = @(y) 0.2 * (2*rand - 1) + y;
for i = 1:length(datsetnames_)
    xpos(i,:) = xposscatter(g);
end
datsetlabels = cellfun(@(x)strrep(x,'_',' '),datsetnames_,'UniformOutput',0);

figure('Units','inches','Position',[0 0 25 8]); hold on;
b = boxplot(corrmat_,g,'Colors',cmap_,'Symbol','');
set(b,{'linew'},{2})
plothands_leg = [];
for i = 1:length(datsetnames_)
    v = gscatter(xpos(i,:),corrmat_(i,:),g,cmap_,shapes{i},7,'off');
    if strcmp('Hurtado',datsetnames_{i})
        scatter(xpos(i,:),corrmat_(i,:),75,['k' shapes{i}],'filled')
    end
    w = gscatter(NaN(1,length(g)),NaN(1,length(g)),g,'k',shapes{i},7,'off');
    for n = 1:length(v)
        if ~strcmp('Hurtado',datsetnames_{i})
            set(v(n), 'MarkerFaceColor', cmap_(n,:));
        end
        set(w(n), 'MarkerFaceColor', 'k');
    end
    plothands_leg = [plothands_leg, w]; %#ok<AGROW> 
end
plot([0,length(subclasses_)+1],[0,0],'LineStyle','--','Color',[0.25 0.25 0.25],'LineWidth',1.5);
xlim([0,length(subclasses_)+1])
plothands_leg = plothands_leg(1,:);
legend(plothands_leg,datsetlabels,'Location','northeast','NumColumns',5,'FontSize',20);
set(gca,'XTick',1:length(subclasses_),'XTickLabel',subclasses_,'XTickLabelRotation',90);
set(gca,'YTick',[-1 -0.5 0 0.5 1])
if strcmp(type,'Pearson')
    ylabel("Pearson's R");
    figstr = [figdir_ filesep 'CorrBarChart_'];
elseif strcmp(type,'Partial')
    ylabel("Partial Correlation \rho");
    figstr = [figdir_ filesep 'ParcorrBarChart_'];
end
if length(subclasses_) == 25
    figstr = [figstr 'Tasic'];
elseif length(subclasses_) == 42
    figstr = [figstr 'Yao'];
end
xlabel('');
set(gca,'TickLength',[0 0])
set(gca, 'FontSize', 24, 'FontName', 'Times');
if savenclose
    print(figstr,'-dtiffn','-r600'); close;
end
end