function PValuePlot(logpmat_,datsetnames_,subclasses_,type,cmap_,cmap_labs,savenclose,figdir_)
if nargin < 8
    figdir_ = cd;
    if nargin < 7
        savenclose = 0;
        if nargin < 6
            cmap_labs = 'hsv';
            if nargin < 5
                cmap_ = hot(1000);
            end
        end
    end
end

datsetlabels = cellfun(@(x)strrep(x,'_',' '),datsetnames_,'UniformOutput',0);
if length(subclasses_) == 25
    % Will finish for Tasic at a later time

elseif length(subclasses_) == 42
    nonneuronal_inds = find(ismember(subclasses_,{'Endo','Astro','Oligo',...
        'Micro-PVM','SMC-Peri','VLMC'}));
    gaba_inds = find(ismember(subclasses_,{'Lamp5','Sncg','Meis2','CR',...
        'Pvalb','Sst','Sst Chodl','Vip'}));
    ctxtest = @(x) strcmp(x(end),'X');
    glutctx_inds = find(logical(cell2mat(cellfun(ctxtest,subclasses_,'UniformOutput',false))));
    gluthipp_inds = setdiff((1:length(subclasses_)).',[nonneuronal_inds;gaba_inds;glutctx_inds]);
    indcell = {glutctx_inds,gluthipp_inds,gaba_inds,nonneuronal_inds};
    indtest = [glutctx_inds;gluthipp_inds;gaba_inds;nonneuronal_inds];
    if strcmp(cmap_labs,'cool')
        cmap_labs = cool(length(indcell));
    elseif strcmp(cmap_labs,'hsv')
        cmap_labs = hsv(length(indcell));
    elseif strcmp(cmap_labs,'lines')
        cmap_labs = lines(length(indcell));
    else
        cmap_labs = twocolor(cmap_labs(1,:),cmap_labs(2,:),length(indcell));
    end
end

cmap_x = zeros(length(indtest),3);
for i = 1:length(indtest)
    colorinds = zeros(1,length(indcell));
    for j = 1:length(indcell)
        colorinds(j) = ismember(i,indcell{j});
    end
    cmap_x(i,:) = cmap_labs(logical(colorinds),:);
end
cmap_x = cmap_x(indtest,:);
logpmat_ = logpmat_(:,indtest);
subclasses_ = subclasses_(indtest);

figure('Units','inches','Position',[0 0 25 8])
imagesc(logpmat_,[0,10]); colormap(cmap_); colorbar;
xlabs = cell(1,length(subclasses_));
for i = 1:length(subclasses_)
    col = cmap_x(i,:);
    xlabs{i} = sprintf('\\color[rgb]{%f,%f,%f}%s',col(1),col(2),col(3),subclasses_{i});
end
set(gca,'TickLength',[0 0],'DataAspectRatio',[1 1 1],'XTick',1:length(subclasses_),...
    'XTickLabelRotation',90,'XTickLabel',xlabs,...
    'YTick',1:length(datsetnames_),'YTickLabel',datsetlabels,...
    'TickLabelInterpreter','tex','FontName','Times','FontSize',20)
if strcmp(type,'Pearson')
    title("-log_1_0(p-value), Pearson's R");
    figstr = 'PValuePlot_Pearson_';
elseif strcmp(type,'Partial')
    title("-log_1_0(p-value), Partial Correlation \rho")    
    figstr = 'PValuePlot_Partial_';
end
if length(subclasses_) == 25
    figstr = [figstr 'Tasic'];
elseif length(subclasses_) == 42
    figstr = [figstr 'Yao'];
end
if savenclose
    print([figdir_ filesep figstr],'-dtiffn','-r600'); close;
end
end