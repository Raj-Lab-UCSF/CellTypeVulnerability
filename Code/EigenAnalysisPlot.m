function V_ = EigenAnalysisPlot(corrmat_t_,genemat_,ctmat_,subclasses_,mattype_,...
    savenclose,figdir_)

nonneuronal_inds = ismember(subclasses_,{'Endo','Astro','Oligo',...
    'Micro-PVM','SMC-Peri','VLMC'});
gaba_inds = ismember(subclasses_,{'Lamp5','Sncg','Meis2','CR',...
    'Pvalb','Sst','Sst Chodl','Vip'});
glutctx_other_inds = find(ismember(subclasses_,{'Car3','L4 RSP-ACA'}));
ctxtest = @(x) strcmp(x(end),'X');
glutctx_inds = find(logical(cell2mat(cellfun(ctxtest,subclasses_,'UniformOutput',false))));
glutctx_inds = sort([glutctx_other_inds; glutctx_inds]);
glutctx_inds = ismember(subclasses_,subclasses_(glutctx_inds));
gluthipp_inds = ~logical(nonneuronal_inds + gaba_inds + glutctx_inds);
indcell = {glutctx_inds,gluthipp_inds,gaba_inds,nonneuronal_inds};
indtest = glutctx_inds + 2*gluthipp_inds + 3*gaba_inds + 4*nonneuronal_inds;
cmap_col = [[0 0.75 1]; [1 0 0.5]];
cmap_base = twocolor(cmap_col(1,:),cmap_col(2,:),length(indcell));

switch mattype_
    case 'AllGenes'
        datamat = genemat_;
        figstr = 'AllGenes';
    case 'MRx3'
        datamat = genemat_;
        figstr = 'MRx3';
    case 'Spatial'
        datamat = ctmat_;
        figstr = 'Spatial';
end
datamat = datamat / max(datamat(:));
D_ = squareform(pdist(datamat.','correlation'));
S_ = 1./D_;
S_(logical(eye(size(S_)))) = 0;
S_ = (S_ - min(S_(:)))/(max(S_(:))-min(S_(:)));

nodesign = sign(mean(corrmat_t_).');
cmapidx = (nodesign + 3)/2;
cmap_all = NaN(length(nodesign),3);
cmap = [[0 0 1]; [1 0 0]];
for i = 1:size(cmap,1)
    inds = cmapidx == i;
    cmap_all(inds,:) = repmat(cmap(i,:),sum(inds),1);
end
markersizes = 2500*abs(mean(corrmat_t_).');
yoffsets = markersizes / mean(markersizes); yoffsets = yoffsets - 1;
yoffsets = 0.025*(1 + 0.3*yoffsets);

L_ = eye(size(S_)) - diag(sum(S_).^(-1))*S_;
[V_,~] = eig(L_);
V2 = V_(:,2); V3 = V_(:,3);
if ~strcmp(mattype_,'Spatial')
    V2 = -V2; V3 = -V3;
end

figure('Units','inches','Position',[0 0 9 9]); hold on;
for i = 1:length(unique(indtest))
    inds = indtest==i;
    h = scatter(V2(inds),V3(inds),markersizes(inds),cmap_all(inds,:),'filled');
    h.MarkerFaceAlpha = 0.25;
    dx = 0; dy = yoffsets; 
    text(V2(inds)+dx,V3(inds)+dy(inds),...
        subclasses_(inds),'FontSize',18,'FontName','Times',...
        'HorizontalAlignment','center','Color',cmap_base(i,:));
%     h = scatter(V_spat(inds,2),V_spat(inds,3),markersizes(inds),...
%         cmap_all(inds,:),'filled','MarkerEdgeColor',cmap_base(i,:),...
%         'LineWidth',2);
%     h.MarkerFaceAlpha = 0.25;
%     x = V_spat(inds,2); y = V_spat(inds,3); 
%     mrksiz = markersizes(inds); clr = cmap_all(inds,:);
%     for j = 1:length(x)
%         h = scatter(x(j),y(j),mrksiz(j),...
%             cmap_base(i,:),'filled','MarkerEdgeColor',clr(j,:),...
%             'LineWidth',1);
%         h.MarkerFaceAlpha = 0.5;
%     end
end
maxx = max(V2); minx = min(V2);
maxy = max(V3); miny = min(V3);
xlim([minx-0.05 maxx+0.05]); ylim([miny-0.05 maxy+0.05]);
xticks([minx,(minx+maxx)/2,maxx]); xtickformat('%.2f');
yticks([miny,(miny+maxy)/2,maxy]); ytickformat('%.2f');
if strcmp(mattype_,'Spatial')
    xlabel('$v_{2}, L_{spatial}$','Interpreter','latex'); 
    ylabel('$v_{3}, L_{spatial}$','Interpreter','latex'); 
else
    xlabel('$v_{2}, L_{gene}$','Interpreter','latex'); 
    ylabel('$v_{3}, L_{gene}$','Interpreter','latex'); 
end
set(gca,'FontSize',26,'FontName','Times','box','on');

if savenclose
    print([figdir_ filesep 'EigenAnalysisPlot_' figstr],'-dtiffn','-r600'); close;
end
end