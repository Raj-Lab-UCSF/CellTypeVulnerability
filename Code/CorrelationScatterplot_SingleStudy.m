function CorrelationScatterplot_SingleStudy(corrmat_,datsetnames_,...
    subclasses_,outputs,Xct_,tpt_,usemax_,seedcorr_,matdir_,cmap_,...
    savenclose,figdir_)

if length(subclasses_) == 25
    % Will finish for Tasic at a later time
elseif length(subclasses_) == 42
    nonneuronal_inds = find(ismember(subclasses_,{'Endo','Astro','Oligo',...
        'Micro-PVM','SMC-Peri','VLMC'}));
    gaba_inds = find(ismember(subclasses_,{'Lamp5','Sncg','Meis2','CR',...
        'Pvalb','Sst','Sst Chodl','Vip'}));
    glutctx_other_inds = find(ismember(subclasses_,{'Car3','L4 RSP-ACA'}));
    ctxtest = @(x) strcmp(x(end),'X');
    glutctx_inds = find(logical(cell2mat(cellfun(ctxtest,subclasses_,'UniformOutput',false))));
    glutctx_inds = sort([glutctx_other_inds; glutctx_inds]);
    gluthipp_inds = setdiff((1:length(subclasses_)).',[nonneuronal_inds;gaba_inds;glutctx_inds]);
    indcell = {glutctx_inds,gluthipp_inds,gaba_inds,nonneuronal_inds};
    if strcmp(cmap_,'cool')
        cmap_labs = cool(length(indcell));
    elseif strcmp(cmap_,'hsv')
        cmap_labs = hsv(length(indcell));
    elseif strcmp(cmap_,'lines')
        cmap_labs = lines(length(indcell));
    else
        cmap_labs = twocolor(cmap_(1,:),cmap_(2,:),length(indcell));
    end
else
    if strcmp(cmap_,'cool')
        cmap_labs = cool(length(subclasses_));
    elseif strcmp(cmap_,'hsv')
        cmap_labs = hsv(length(subclasses_));
    elseif strcmp(cmap_,'lines')
        cmap_labs = lines(length(subclasses_));
    else
        cmap_labs = twocolor(cmap_(1,:),cmap_(2,:),length(subclasses_));
    end
    indcell = cell(1,length(subclasses_));
    for i = 1:length(indcell)   
        indcell{i} = i;
    end
end

if usemax_
    [maxes_ct,datsetind] = max(corrmat_);
    [~,peakind_ct] = max(maxes_ct); 
else
    [mins_ct,datsetind] = min(corrmat_);
    [~,peakind_ct] = min(mins_ct);
end

datsetname_ = datsetnames_{datsetind};
Xct_data = CCFToData(Xct_,datsetname_,matdir_);
Y_all = outputs.(datsetname_).data;
if strcmp(tpt_,'end')
    t_ = length(outputs.(datsetname_).time_stamps);
else
    t_ = tpt_;
end
Y = Y_all(:,t_);
if logical(seedcorr_) && (sum(outputs.(datsetname_).seed)>0)
    Y(logical(outputs.(datsetname_).seed),:) = [];
    Xct_data(logical(outputs.(datsetname_).seed),:) = [];
end

ctname_ = subclasses_{peakind_ct};
datsetname_plot = strrep(datsetname_,'_',' ');
Xct_peak = Xct_data(:,peakind_ct);
cmap_ind_peak = zeros(1,size(cmap_labs,1));
for i = 1:size(cmap_labs,1)
    if ismember(peakind_ct,indcell{i})
        cmap_ind_peak(i) = 1;
    end
end
clr_ = cmap_labs(logical(cmap_ind_peak),:);

lm = fitlm(Xct_peak,Y);  
x_lm = linspace(min(Xct_peak),max(Xct_peak),100).'; 
[y_lm, y_ci] = predict(lm, x_lm);

shapes = {'o','s','d','^','v','<','>','p','h','+','.','s'};
shape = shapes{ismember(datsetnames_,datsetname_)};

figure('Units','inches','Position',[0 0 9 9]); hold on;
plot(Xct_peak,Y,'LineStyle','none','MarkerSize',10,...
    'MarkerFaceColor',clr_,'Marker',shape,'MarkerEdgeColor',clr_);
plot(x_lm,y_ci(:,1),'k:'); plot(x_lm,y_ci(:,2),'k:'); 
fill([x_lm; flipud(x_lm)],[y_ci(:,1); flipud(y_ci(:,2))],[1 0 0.25],'EdgeColor','none','FaceAlpha',0.15);
plot(x_lm,y_lm,'k','LineWidth',2);

xmax = max(Xct_peak); xmin = min(Xct_peak);
xlim([xmin,xmax]); xticks([xmin,(xmax+xmin)/2,xmax]);
if xmin == 0
    xticklabels({'0',num2str((xmin+xmax)/2,'%.1e'),num2str(xmax,'%.1d')});
else
    xticklabels({num2str(xmin,'%.1e'),num2str((xmin+xmax)/2,'%.1e'),num2str(xmax,'%.1d')});
end
ymin = 0; ymax = max(Y);
ytickmax = max(Y);
ylim(1.05*[ymin,ymax]);
yticks([0,ytickmax/2,ytickmax]);
yticklabels({'0',num2str(ytickmax/2,'%.1f'),num2str(ytickmax,'%.1f')});

rsq_adj = lm.Rsquared.Adjusted;
pvalr2 = lm.ModelFitVsNullModel.Pvalue;
ntests = length(subclasses_);
pvalr2str = [];
if pvalr2 < 0.05/ntests % Bonferroni
    pvalr2str = [pvalr2str '^*'];
    if pvalr2 < 0.01/ntests 
        pvalr2str = [pvalr2str '^*'];
        if pvalr2 < 0.001/ntests
            pvalr2str = [pvalr2str '^*'];
            if pvalr2 < 0.0001/ntests
                pvalr2str = [pvalr2str '^*'];
            end
        end
    end
end

[rhoval,rhop] = corr(Xct_peak,Y,'type','Spearman');
pvalrhostr = [];
if rhop < 0.05/ntests % Bonferroni
    pvalrhostr = [pvalrhostr '^*'];
    if rhop < 0.01/ntests 
        pvalrhostr = [pvalrhostr '^*'];
        if rhop < 0.001/ntests
            pvalrhostr = [pvalrhostr '^*'];
            if rhop < 0.0001/ntests
                pvalrhostr = [pvalrhostr '^*'];
            end
        end
    end
end
if ~usemax_
    text(0.75*(xmax-xmin)+xmin, 0.925*(ymax-ymin)+ymin,...
        {sprintf('R^2 = %.2f%s',rsq_adj,pvalr2str),...
        sprintf([char(961) ' = %.2f%s'],rhoval,pvalrhostr)},...
        'FontName','Times','FontSize',22);
else
    text(0.75*(xmax-xmin)+xmin, 0.1*(ymax-ymin)+ymin,...
        {sprintf('R^2 = %.2f%s',rsq_adj,pvalr2str),...
        sprintf([char(961) ' = %.2f%s'],rhoval,pvalrhostr)},...
        'FontName','Times','FontSize',22);
end

xlabel(['Density, ' ctname_]);
ylabel(['Tau Pathology, ' datsetname_plot]);
set(gca,'FontName','Times','FontSize',26,'box','on');

figstr = ['PathologyScatterplot_' ctname_ '_' datsetname_ '_'];
if savenclose
    print([figdir_ filesep figstr],'-dtiffn','-r600'); close;
end
end