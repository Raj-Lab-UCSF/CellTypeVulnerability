function [corrmat_all,logpmat_all] = CorrelationCalculator_singledataset(datsetname_,...
    outputs,Xct_,corrtype_)
% Calculate and store correlations

corrmat_all = zeros(length(outputs.(datsetname_).time_stamps),size(Xct_,2));
logpmat_all = corrmat_all;
for j = 1:length(outputs.(datsetname_).time_stamps)
    Y = outputs.(datsetname_).data(:,j);
    naninds = isnan(Y);
    Y = Y(~naninds);
    Xct_j = Xct_(~naninds,:);
    testmat = [Y Xct_j];
    if strcmp(corrtype_,'Pearson')
        [corrmat,corrp] = corrcoef(testmat);
        corrmat_all(j,:) = corrmat(1,2:end);
        logpmat_all(j,:) = -log10(corrp(1,2:end));
    elseif strcmp(corrtype_,'Partial')
        [corrmat,corrp] = partialcorr(testmat);
        corrmat_all(j,:) = corrmat(1,2:end);
        logpmat_all(j,:) = -log10(corrp(1,2:end));
    end
end
end